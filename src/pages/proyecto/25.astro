---
import BaseLayout from '../../components/BaseLayout.astro';
import Topbar from '../../components/Topbar.astro';
import InformeCarousel from '../../components/InformeCarousel.astro';
import CodeSection from '../../components/CodeSection.astro';
import Footer from '../../components/Footer.astro';

const informeSlides = [
  { section: "Portada", title: "Procesos de Poisson en Mutaciones del Gen TP53", subtitle: "Análisis Estadístico de Variantes Genéticas", bullets: ["Grupo G42 · Noviembre 2025", "Procesos Estocásticos y Series de Tiempo", "Universidad Mayor de San Andrés"], image: "https://images.unsplash.com/photo-1628595351029-c2bf17511435?w=800&q=80" },
  { section: "Resumen", title: "Resumen Ejecutivo", bullets: ["Análisis de 33,603 variantes únicas del gen TP53 con 37 millones de eventos", "Modelado con Procesos de Poisson homogéneos y no homogéneos", "Identificación de hotspots mutacionales en codones críticos", "Validación estadística y detección de sobredispersión extrema"], image: "https://images.unsplash.com/photo-1530026186672-2cd00ffc50fe?w=800&q=80" },
  { section: "Introducción", title: "El Gen TP53: Guardián del Genoma", bullets: ["TP53 codifica la proteína p53, supresora de tumores más estudiada", "Mutado en >50% de todos los cánceres humanos", "Regula ciclo celular, apoptosis y reparación del ADN", "Base de datos UMD: repositorio mundial con 33,603 variantes únicas"], image: "https://images.unsplash.com/photo-1559757175-5700dde675bc?w=800&q=80" },
  { section: "Problema", title: "Planteamiento del Problema", bullets: ["Las mutaciones no se distribuyen uniformemente en el gen", "Algunos codones acumulan miles de veces más mutaciones que otros", "Factores biológicos (sitios CpG) alteran las tasas locales", "Se requiere un modelo que capture esta heterogeneidad espacial y temporal"], image: "https://images.unsplash.com/photo-1532187863486-abf9dbad1b69?w=800&q=80" },
  { section: "Marco Teórico", title: "Proceso de Poisson Homogéneo", bullets: ["N(t) cuenta eventos en intervalo [0,t] con tasa CONSTANTE λ", "P(N(t)=k) = (λt)^k · e^(-λt) / k!", "E[N(t)] = Var[N(t)] = λt (equidispersión)", "Tiempos entre eventos siguen distribución Exponencial(λ)"], image: "https://images.unsplash.com/photo-1509228627152-72ae9ae6848d?w=800&q=80" },
  { section: "Marco Teórico", title: "Proceso de Poisson NO Homogéneo", bullets: ["Tasa λ(t) VARIABLE en el tiempo: λ(t) = a + b·t", "Intensidad acumulada: Λ(t) = ∫₀ᵗ λ(s)ds", "Captura tendencias temporales en la tasa de mutación", "En TP53: λ(t) = 10,769.5 - 4.82·t (tendencia decreciente)"], image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&q=80" },
  { section: "Marco Teórico", title: "Proceso de Poisson Compuesto", bullets: ["Cada tumor puede tener múltiples mutaciones TP53", "N tumores llegan con tasa λ, cada uno con Xᵢ mutaciones", "S = Σᵢ₌₁ᴺ Xᵢ es el total de mutaciones observadas", "E[S] = λ·E[X], Var[S] = λ·E[X²]"], image: "https://images.unsplash.com/photo-1576086213369-97a306d36557?w=800&q=80" },
  { section: "Metodología", title: "Fuente de Datos: TP53 UMD", bullets: ["Base de datos Universal Mutation Database (UMD)", "33,603 variantes únicas del gen TP53", "37,018,402 eventos mutacionales totales", "Período: 1989-2016 (27 años de registros)"], image: "https://images.unsplash.com/photo-1518152006812-edab29b069ac?w=800&q=80" },
  { section: "Resultados", title: "Estimación de λ Global", bullets: ["λ global = 1,101.64 ocurrencias/variante", "IC 95%: [1,101.28 , 1,101.99]", "Total eventos: 37,018,402", "Mediana: 508 (distribución muy sesgada a la derecha)"], image: "https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&q=80" },
  { section: "Resultados", title: "Comparación CpG vs No-CpG", bullets: ["λ sitios CpG = 1,931.93 (hotspots bioquímicos)", "λ no-CpG = 299.95", "Ratio CpG/no-CpG = 6.44× mayor", "Los dinucleótidos CpG son hipermutables por desaminación"], image: "https://images.unsplash.com/photo-1607619056574-7b8d3ee536b2?w=800&q=80" },
  { section: "Resultados", title: "Hotspots Identificados (Top 5)", bullets: ["Codón 175 (R175H): 9.3M eventos, λ=3,205", "Codón 248 (R248Q/W): 8.6M eventos, λ=2,189", "Codón 273 (R273H/C): 8.4M eventos, λ=2,072", "Solo 8 codones (5%) acumulan >498,000 mutaciones c/u"], image: "https://images.unsplash.com/photo-1579165466949-3180a3d056d5?w=800&q=80" },
  { section: "Resultados", title: "Validación: Índice de Dispersión", bullets: ["Media: 1,101.64 | Varianza: 1,192,660.46", "Índice de dispersión = Var/Media = 1,082.6", "Sobredispersión EXTREMA detectada (≫1)", "Conclusión: Poisson simple NO es adecuado"], image: "https://images.unsplash.com/photo-1504868584819-f8e8b4b6d7e3?w=800&q=80" },
  { section: "Resultados", title: "Proceso No Homogéneo: Tendencia Temporal", bullets: ["Modelo ajustado: λ(t) = 10,769.5 - 4.82·t", "R² = 0.184, p = 0.026 (significativo al 5%)", "Tendencia DECRECIENTE: -4.82 unidades/año", "Mutaciones recientes son menos recurrentes"], image: "https://images.unsplash.com/photo-1611974789855-9c2a0a7236a3?w=800&q=80" },
  { section: "Resultados", title: "Procesos Compuestos: Mutaciones Múltiples", bullets: ["87.5% de tumores tienen 1 sola mutación TP53 (SM)", "12.5% tienen mutaciones múltiples (DMU, MM)", "λ simples = 1,136 vs λ múltiples = 860", "Media: 1.15 mutaciones/tumor"], image: "https://images.unsplash.com/photo-1582719471384-894fbb16f2b1?w=800&q=80" },
  { section: "Conclusiones", title: "Conclusiones Principales", bullets: ["Los datos NO siguen Poisson simple (sobredispersión 1,082×)", "Los sitios CpG son hotspots con λ 6.4× mayor que no-CpG", "Solo 8 codones concentran la mayoría de mutaciones", "El proceso NO homogéneo captura la tendencia temporal"], image: "https://images.unsplash.com/photo-1581093458791-9d42e3c2fd45?w=800&q=80" },
  { section: "Aplicaciones", title: "Aplicaciones Clínicas", bullets: ["Priorización de paneles de secuenciación genética", "Cálculo de probabilidad de mutación por codón", "Detección temprana enfocada en hotspots R175, R248, R273", "Desarrollo de terapias dirigidas a mutaciones frecuentes"], image: "https://images.unsplash.com/photo-1631549916768-4119b2e5f926?w=800&q=80" }
];

const hotspotsCodones = [
  { codon: 175, eventos: 9288241, lambda: 3205.05 },
  { codon: 248, eventos: 8595606, lambda: 2188.85 },
  { codon: 273, eventos: 8443026, lambda: 2072.42 },
  { codon: 282, eventos: 2088720, lambda: 1398.07 },
  { codon: 245, eventos: 1458766, lambda: 813.14 },
  { codon: 220, eventos: 1313082, lambda: 1201.36 },
  { codon: 213, eventos: 1220078, lambda: 1102.15 },
  { codon: 196, eventos: 582823, lambda: 812.86 }
];

const enfermedadLambda = [
  { enfermedad: "Colorectal", lambda: 1552.72, n: 4901 },
  { enfermedad: "Glioblastoma", lambda: 1290.00, n: 1053 },
  { enfermedad: "Gástrico", lambda: 1293.80, n: 1028 },
  { enfermedad: "Pancreático", lambda: 1198.63, n: 802 },
  { enfermedad: "Ovario", lambda: 1139.72, n: 2026 },
  { enfermedad: "Mama", lambda: 1069.40, n: 3878 },
  { enfermedad: "Cabeza/Cuello", lambda: 990.59, n: 2682 },
  { enfermedad: "Esófago", lambda: 960.64, n: 1188 },
  { enfermedad: "Vejiga", lambda: 875.43, n: 1171 },
  { enfermedad: "Pulmón NSCLC", lambda: 647.54, n: 2894 }
];

const datosTemporal = [
  { year: 1990, lambda: 1589 }, { year: 1991, lambda: 1456 }, { year: 1992, lambda: 1378 },
  { year: 1993, lambda: 1445 }, { year: 1994, lambda: 1289 }, { year: 1995, lambda: 1356 },
  { year: 1996, lambda: 1234 }, { year: 1997, lambda: 1189 }, { year: 1998, lambda: 1145 },
  { year: 1999, lambda: 1098 }, { year: 2000, lambda: 1156 }, { year: 2001, lambda: 1089 },
  { year: 2002, lambda: 1067 }, { year: 2003, lambda: 1034 }, { year: 2004, lambda: 1078 },
  { year: 2005, lambda: 1023 }, { year: 2006, lambda: 1045 }, { year: 2007, lambda: 989 },
  { year: 2008, lambda: 1012 }, { year: 2009, lambda: 978 }, { year: 2010, lambda: 956 },
  { year: 2011, lambda: 934 }, { year: 2012, lambda: 912 }, { year: 2013, lambda: 945 },
  { year: 2014, lambda: 923 }, { year: 2015, lambda: 890 }, { year: 2016, lambda: 867 }
];

const cpgComparison = { lambdaCpg: 1931.93, lambdaNoCpg: 299.95, ratio: 6.44 };

const codeFiles = [
  {
    filename: "poisson_analysis.py",
    description: "Estimación de λ y validación",
    code: `# Estimación de parámetros λ del Proceso de Poisson
import numpy as np
from scipy import stats

def estimate_lambda_with_ci(data, confidence=0.95):
    n = len(data)
    lambda_est = data.mean()
    sum_x = data.sum()
    alpha = 1 - confidence
    lower = stats.chi2.ppf(alpha/2, 2*sum_x) / (2*n)
    upper = stats.chi2.ppf(1-alpha/2, 2*(sum_x+1)) / (2*n)
    return lambda_est, lower, upper

# Resultados del dataset TP53
lambda_global, ci_lower, ci_upper = estimate_lambda_with_ci(df['Número_Ocurrencias'])
# λ = 1101.64, IC 95%: [1101.28, 1101.99]

# Índice de dispersión (test de equidispersión)
mean_val = df['Número_Ocurrencias'].mean()  # 1101.64
var_val = df['Número_Ocurrencias'].var()    # 1192660.46
dispersion_index = var_val / mean_val       # 1082.62
# CONCLUSIÓN: Sobredispersión extrema (1082 >> 1)`
  },
  {
    filename: "poisson_no_homogeneo.py",
    description: "Modelo temporal λ(t) = a + b·t",
    code: `# Modelado de Proceso de Poisson No Homogéneo
from scipy.stats import linregress
import numpy as np

# Agrupar λ promedio por año
yearly = df.groupby('Año')['Número_Ocurrencias'].mean()

# Ajuste de regresión lineal
slope, intercept, r_value, p_value, std_err = linregress(
    yearly.index, yearly.values
)

# Resultados:
# Intercepto (a) = 10769.53
# Pendiente (b)  = -4.8194
# R² = 0.1839
# p-value = 0.0256 (significativo)

# Modelo: λ(t) = 10769.5 - 4.82·t
# Tendencia DECRECIENTE significativa`
  }
];
---

<BaseLayout 
  title="Proyecto 25 · Mutaciones TP53 con Procesos de Poisson" 
  description="Análisis de mutaciones del gen TP53 usando Procesos de Poisson homogéneos y no homogéneos."
  accentColor="#22d3ee"
  accentColor2="#a78bfa"
>
  <Topbar 
    brandText="Proyecto 25 · TP53 Mutations"
    links={[
      { href: "/", text: "Home" },
      { href: "#informe", text: "Informe" },
      { href: "#simulador", text: "Simulador" },
      { href: "#graficos", text: "Gráficos" },
      { href: "#analisis", text: "Análisis" }
    ]}
  />

  <main>
    <!-- HERO PERSONALIZADO -->
    <section class="hero">
      <div class="hero__copy">
        <p class="eyebrow">Tema 25</p>
        <h1>Procesos de Poisson en Mutaciones del Gen TP53</h1>
        <p class="lede">Análisis estadístico del gen supresor de tumores más importante. Modelado con procesos de Poisson <strong>homogéneos</strong> y <strong>no homogéneos</strong> para identificar hotspots mutacionales y tendencias temporales.</p>
        <div class="tags">
          <span>Gen TP53 · p53</span>
          <span>Poisson Homogéneo</span>
          <span>Poisson No Homogéneo</span>
          <span>Bioinformática</span>
        </div>
        <div class="cta">
          <a class="primary" href="#simulador">Simulador Interactivo</a>
          <a class="ghost" href="#graficos">Ver Gráficos</a>
        </div>
      </div>
      <div class="hero__panel">
        <div class="panel__header"><span class="chip">Dataset Real</span><span class="status">TP53 UMD</span></div>
        <div class="panel__list">
          <div class="panel__item"><span class="label">Variantes únicas</span><p>33,603 mutaciones</p></div>
          <div class="panel__item"><span class="label">Total de eventos</span><p>37,018,402 ocurrencias</p></div>
          <div class="panel__item"><span class="label">Tasa λ global</span><p>1,101.64 /variante</p></div>
          <div class="panel__item"><span class="label">Índice Dispersión</span><p class="warning">1,082.6 (sobredispersión)</p></div>
        </div>
        <div class="panel__footer"><span class="bubble ghost">1989-2016</span><span class="bubble">CpG 6.44× más</span></div>
      </div>
    </section>

    <InformeCarousel slides={informeSlides} id="informe" />

    <!-- SIMULADOR INTERACTIVO -->
    <section class="simulator" id="simulador">
      <div class="section__head">
        <div>
          <p class="eyebrow">Simulación de Mutaciones</p>
          <h2>Visualización: Poisson Homogéneo vs No Homogéneo</h2>
          <p class="section__lede">Observá cómo las <strong>mutaciones</strong> ocurren aleatoriamente. Compará un proceso con tasa constante vs uno con tasa decreciente.</p>
        </div>
      </div>
      <div class="sim-container">
        <div class="sim-controls">
          <div class="control-group"><label>Tasa de mutación λ</label><input type="range" id="sim-lambda" min="5" max="50" value="20" step="1"><span id="sim-lambda-val">20 mut/año</span></div>
          <div class="control-group"><label>Pendiente temporal (b)</label><input type="range" id="sim-slope" min="-2" max="2" value="-0.5" step="0.1"><span id="sim-slope-val">-0.5</span></div>
          <div class="control-group"><label>Tiempo (años)</label><input type="range" id="sim-time" min="5" max="30" value="20" step="1"><span id="sim-time-val">20 años</span></div>
          <button id="sim-run" class="sim-btn pulse"><span class="btn-icon">▶</span> Generar Mutaciones</button>
        </div>
        <div class="sim-stats">
          <div class="stat-box hom"><span class="stat-label">Homogéneo</span><span class="stat-value" id="stat-hom-count">0</span><span class="stat-unit">mutaciones</span></div>
          <div class="stat-box nhom"><span class="stat-label">No Homogéneo</span><span class="stat-value" id="stat-nhom-count">0</span><span class="stat-unit">mutaciones</span></div>
          <div class="stat-box diff"><span class="stat-label">Diferencia</span><span class="stat-value" id="stat-diff">0%</span><span class="stat-unit">más/menos</span></div>
        </div>
        <div class="sim-charts-grid">
          <div class="chart-box"><div class="chart-header hom"><span class="chart-dot"></span><h4>Poisson Homogéneo (λ constante)</h4></div><div id="chart-mutations-hom" class="mutation-chart"></div></div>
          <div class="chart-box"><div class="chart-header nhom"><span class="chart-dot"></span><h4>Poisson No Homogéneo (λ(t) decreciente)</h4></div><div id="chart-mutations-nhom" class="mutation-chart"></div></div>
        </div>
        <div class="chart-box wide"><div class="chart-header comparison"><span class="chart-icon">≡</span><h4>Comparación: Mutaciones Acumuladas N(t)</h4></div><div id="chart-cumulative" class="mutation-chart tall"></div></div>
        <div class="sim-charts-grid">
          <div class="chart-box"><div class="chart-header hom"><h4>Distribución de Intervalos (Homogéneo)</h4></div><div id="chart-intervals-hom" class="mutation-chart"></div></div>
          <div class="chart-box"><div class="chart-header nhom"><h4>Distribución de Intervalos (No Homogéneo)</h4></div><div id="chart-intervals-nhom" class="mutation-chart"></div></div>
        </div>
        <div class="sim-formulas">
          <div class="formula-box hom-box"><h5>Proceso Homogéneo</h5><div class="formula-content" id="formula-hom"></div></div>
          <div class="formula-box nhom-box"><h5>Proceso No Homogéneo</h5><div class="formula-content" id="formula-nhom"></div></div>
        </div>
      </div>
    </section>

    <!-- GRÁFICOS INTERACTIVOS -->
    <section class="charts-section" id="graficos">
      <div class="section__head">
        <div>
          <p class="eyebrow">Visualizaciones</p>
          <h2>Gráficos Interactivos del Dataset TP53</h2>
          <p class="section__lede">Datos reales de 33,603 variantes del gen TP53.</p>
        </div>
      </div>
      <div class="charts-grid">
        <div class="chart-card wide"><h4>Hotspots Mutacionales: Top 8 Codones</h4><div id="chart-hotspots" class="plotly-chart"></div></div>
        <div class="chart-card"><h4>Comparación CpG vs No-CpG</h4><div id="chart-cpg" class="plotly-chart"></div></div>
        <div class="chart-card"><h4>Tasa λ por Tipo de Cáncer</h4><div id="chart-disease" class="plotly-chart"></div></div>
        <div class="chart-card wide"><h4>Evolución Temporal de λ (Proceso No Homogéneo)</h4><div id="chart-temporal" class="plotly-chart"></div></div>
      </div>
    </section>

    <!-- ANÁLISIS -->
    <section class="analysis" id="analisis">
      <div class="section__head">
        <div>
          <p class="eyebrow">Análisis Completo</p>
          <h2>Resultados del Jupyter Notebook</h2>
        </div>
      </div>
      <div class="analysis-grid">
        <div class="analysis-card">
          <div class="card-header"><span class="module-num">01</span><h4>Estadísticas Descriptivas</h4></div>
          <table class="data-table">
            <tr><td>Total variantes únicas</td><td class="val">33,603</td></tr>
            <tr><td>Total eventos</td><td class="val">37,018,402</td></tr>
            <tr><td>Media (λ global)</td><td class="val">1,101.64</td></tr>
            <tr><td>Mediana</td><td class="val">508.00</td></tr>
          </table>
        </div>
        <div class="analysis-card highlight">
          <div class="card-header"><span class="module-num">02</span><h4>Estimación de λ</h4></div>
          <div class="param-box"><span class="param-label">λ Global</span><span class="param-value">1,101.64</span><span class="param-ci">IC 95%: [1,101.28 , 1,101.99]</span></div>
          <div class="param-row">
            <div class="param-item"><span class="label">λ CpG</span><span class="value">1,931.93</span></div>
            <div class="param-item"><span class="label">λ No-CpG</span><span class="value">299.95</span></div>
            <div class="param-item accent"><span class="label">Ratio</span><span class="value">6.44×</span></div>
          </div>
        </div>
        <div class="analysis-card warning">
          <div class="card-header"><span class="module-num">03</span><h4>Validación del Modelo</h4></div>
          <div class="validation-grid">
            <div class="val-metric"><span class="metric-label">Media</span><span class="metric-value">1,101.64</span></div>
            <div class="val-metric"><span class="metric-label">Varianza</span><span class="metric-value">1,192,660</span></div>
            <div class="val-metric big warning"><span class="metric-label">Índice</span><span class="metric-value">1,082.6</span></div>
          </div>
          <div class="conclusion warning"><strong>SOBREDISPERSIÓN:</strong> Poisson simple NO adecuado.</div>
        </div>
        <div class="analysis-card">
          <div class="card-header"><span class="module-num">04</span><h4>Proceso No Homogéneo</h4></div>
          <div class="model-box"><span class="model-label">Modelo:</span><span class="model-formula" id="model-temporal"></span></div>
          <table class="data-table">
            <tr><td>Pendiente (b)</td><td class="val">-4.82 /año</td></tr>
            <tr><td>R²</td><td class="val">0.184</td></tr>
            <tr><td>p-value</td><td class="val">0.026</td></tr>
          </table>
        </div>
      </div>
    </section>

    <CodeSection
      title="Jupyter Notebook: Análisis Completo"
      subtitle="Código Python del análisis estadístico. Datos: <code>mutaciones_es.xlsx</code>"
      files={codeFiles}
      runCommands={`pip install pandas numpy scipy matplotlib seaborn openpyxl
jupyter notebook "25 (1).ipynb"`}
    />
  </main>

  <Footer rightText="Proyecto 25 · Procesos de Poisson" />
</BaseLayout>

<script define:vars={{ hotspotsCodones, enfermedadLambda, datosTemporal, cpgComparison }}>
  window.hotspotsCodones = hotspotsCodones;
  window.enfermedadLambda = enfermedadLambda;
  window.datosTemporal = datosTemporal;
  window.cpgComparison = cpgComparison;
</script>

<script is:inline>
  document.addEventListener("DOMContentLoaded", function() {
    var darkLayout = {
      paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0.2)',
      font: { color: '#94a3b8', family: 'Manrope, sans-serif' },
      margin: { t: 30, b: 50, l: 60, r: 20 },
      xaxis: { gridcolor: 'rgba(255,255,255,0.05)' },
      yaxis: { gridcolor: 'rgba(255,255,255,0.05)' }
    };
    
    // Hotspots
    var hotspots = window.hotspotsCodones;
    Plotly.newPlot('chart-hotspots', [{
      x: hotspots.map(h => 'Codón ' + h.codon), y: hotspots.map(h => h.eventos / 1000000), type: 'bar',
      marker: { color: hotspots.map((h,i) => i < 3 ? '#f43f5e' : '#22d3ee') },
      text: hotspots.map(h => 'λ=' + h.lambda.toFixed(0)), textposition: 'outside'
    }], Object.assign({}, darkLayout, { yaxis: { ...darkLayout.yaxis, title: 'Millones de eventos' }, height: 350 }), { responsive: true });
    
    // CpG
    var cpg = window.cpgComparison;
    Plotly.newPlot('chart-cpg', [{
      labels: ['Sitios CpG', 'No-CpG'], values: [cpg.lambdaCpg, cpg.lambdaNoCpg], type: 'pie',
      marker: { colors: ['#f43f5e', '#22d3ee'] }, texttemplate: '%{label}<br>λ=%{value:.0f}'
    }], Object.assign({}, darkLayout, { height: 300, showlegend: false }), { responsive: true });
    
    // Enfermedades
    var enf = window.enfermedadLambda;
    Plotly.newPlot('chart-disease', [{
      y: enf.map(e => e.enfermedad), x: enf.map(e => e.lambda), type: 'bar', orientation: 'h',
      marker: { color: enf.map(e => e.lambda), colorscale: [[0, '#22d3ee'], [1, '#f43f5e']] }
    }], Object.assign({}, darkLayout, { xaxis: { ...darkLayout.xaxis, title: 'Tasa λ' }, height: 350, margin: { l: 100 } }), { responsive: true });
    
    // Temporal
    var temp = window.datosTemporal;
    Plotly.newPlot('chart-temporal', [
      { x: temp.map(t => t.year), y: temp.map(t => t.lambda), type: 'scatter', mode: 'markers', name: 'λ observado', marker: { color: '#22d3ee', size: 10 } },
      { x: temp.map(t => t.year), y: temp.map(t => 10769.5 - 4.82 * t.year), type: 'scatter', mode: 'lines', name: 'Tendencia: λ(t) = 10769.5 - 4.82·t', line: { color: '#f43f5e', width: 3, dash: 'dash' } }
    ], Object.assign({}, darkLayout, { xaxis: { ...darkLayout.xaxis, title: 'Año' }, yaxis: { ...darkLayout.yaxis, title: 'Tasa λ' }, height: 350, showlegend: true, legend: { x: 0.5, y: 1.15, orientation: 'h' } }), { responsive: true });
    
    // KaTeX
    function tryKaTeX() {
      if (typeof katex === 'undefined') { setTimeout(tryKaTeX, 100); return; }
      var formulas = { 'formula-hom': 'P(N(t)=k) = \\frac{(\\lambda t)^k e^{-\\lambda t}}{k!}', 'formula-nhom': '\\lambda(t) = \\lambda_0 + b \\cdot t', 'model-temporal': '\\lambda(t) = 10769.5 - 4.82 \\cdot t' };
      Object.keys(formulas).forEach(id => { var el = document.getElementById(id); if (el) katex.render(formulas[id], el, { displayMode: true, throwOnError: false }); });
    }
    tryKaTeX();
  });
</script>

<script is:inline>
  // Simulador de mutaciones
  document.addEventListener("DOMContentLoaded", function() {
    var lambdaInput = document.getElementById('sim-lambda'), slopeInput = document.getElementById('sim-slope'), timeInput = document.getElementById('sim-time'), runBtn = document.getElementById('sim-run');
    
    function updateLabels() {
      document.getElementById('sim-lambda-val').textContent = lambdaInput.value + ' mut/año';
      document.getElementById('sim-slope-val').textContent = parseFloat(slopeInput.value).toFixed(1);
      document.getElementById('sim-time-val').textContent = timeInput.value + ' años';
    }
    lambdaInput.addEventListener('input', updateLabels);
    slopeInput.addEventListener('input', updateLabels);
    timeInput.addEventListener('input', updateLabels);
    
    function generateHomogeneousPoisson(lambda, maxTime) {
      var events = [], t = 0;
      while (t < maxTime) { t += -Math.log(Math.random()) / lambda; if (t < maxTime) events.push({ time: t, codon: Math.floor(Math.random() * 393) + 1 }); }
      return events;
    }
    
    function generateNonHomogeneousPoisson(lambda0, slope, maxTime) {
      var events = [], lambdaMax = Math.max(lambda0, lambda0 + slope * maxTime), t = 0;
      while (t < maxTime) {
        t += -Math.log(Math.random()) / lambdaMax;
        if (t < maxTime) { var lambdaT = Math.max(0.1, lambda0 + slope * t); if (Math.random() <= lambdaT / lambdaMax) events.push({ time: t, codon: Math.floor(Math.random() * 393) + 1 }); }
      }
      return events;
    }
    
    function getIntervals(events) { var intervals = []; for (var i = 1; i < events.length; i++) intervals.push(events[i].time - events[i-1].time); return intervals; }
    function getCodonColor(codon) { return [175, 248, 273, 282, 245].includes(codon) ? '#f43f5e' : '#22d3ee'; }
    
    var darkLayout = { paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0.15)', font: { color: '#94a3b8', size: 11 }, margin: { t: 10, b: 40, l: 50, r: 20 }, xaxis: { gridcolor: 'rgba(255,255,255,0.05)' }, yaxis: { gridcolor: 'rgba(255,255,255,0.05)' } };
    
    function runMutationSimulation() {
      var lambda = parseFloat(lambdaInput.value), slope = parseFloat(slopeInput.value), maxTime = parseInt(timeInput.value);
      var eventsHom = generateHomogeneousPoisson(lambda, maxTime), eventsNHom = generateNonHomogeneousPoisson(lambda, slope, maxTime);
      
      document.getElementById('stat-hom-count').textContent = eventsHom.length;
      document.getElementById('stat-nhom-count').textContent = eventsNHom.length;
      var diff = ((eventsNHom.length - eventsHom.length) / eventsHom.length * 100).toFixed(1);
      document.getElementById('stat-diff').textContent = (diff > 0 ? '+' : '') + diff + '%';
      
      Plotly.newPlot('chart-mutations-hom', [{ x: eventsHom.map(e => e.time), y: eventsHom.map(e => e.codon), mode: 'markers', type: 'scatter', marker: { size: 6, color: eventsHom.map(e => getCodonColor(e.codon)), opacity: 0.7 } }], Object.assign({}, darkLayout, { xaxis: { ...darkLayout.xaxis, title: 'Tiempo (años)', range: [0, maxTime] }, yaxis: { ...darkLayout.yaxis, title: 'Codón', range: [0, 400] }, height: 260 }), { responsive: true });
      
      Plotly.newPlot('chart-mutations-nhom', [{ x: eventsNHom.map(e => e.time), y: eventsNHom.map(e => e.codon), mode: 'markers', type: 'scatter', marker: { size: 6, color: eventsNHom.map(e => getCodonColor(e.codon)), opacity: 0.7 } }], Object.assign({}, darkLayout, { xaxis: { ...darkLayout.xaxis, title: 'Tiempo (años)', range: [0, maxTime] }, yaxis: { ...darkLayout.yaxis, title: 'Codón', range: [0, 400] }, height: 260 }), { responsive: true });
      
      var cumHom = [], cumNHom = [], timePoints = [];
      for (var i = 0; i <= maxTime * 10; i++) { var t = i / 10; timePoints.push(t); cumHom.push(eventsHom.filter(e => e.time <= t).length); cumNHom.push(eventsNHom.filter(e => e.time <= t).length); }
      
      Plotly.newPlot('chart-cumulative', [
        { x: timePoints, y: cumHom, type: 'scatter', mode: 'lines', name: 'Homogéneo', line: { color: '#22d3ee', width: 3 }, fill: 'tozeroy', fillcolor: 'rgba(34,211,238,0.1)' },
        { x: timePoints, y: cumNHom, type: 'scatter', mode: 'lines', name: 'No Homogéneo', line: { color: '#f43f5e', width: 3 }, fill: 'tozeroy', fillcolor: 'rgba(244,63,94,0.1)' }
      ], Object.assign({}, darkLayout, { xaxis: { ...darkLayout.xaxis, title: 'Tiempo (años)' }, yaxis: { ...darkLayout.yaxis, title: 'N(t) Acumuladas' }, height: 300, showlegend: true, legend: { x: 0.02, y: 0.98, bgcolor: 'rgba(0,0,0,0.5)' } }), { responsive: true });
      
      var intervalsHom = getIntervals(eventsHom), intervalsNHom = getIntervals(eventsNHom);
      Plotly.newPlot('chart-intervals-hom', [{ x: intervalsHom, type: 'histogram', nbinsx: 20, marker: { color: '#22d3ee' } }], Object.assign({}, darkLayout, { xaxis: { ...darkLayout.xaxis, title: 'Intervalo (años)' }, yaxis: { ...darkLayout.yaxis, title: 'Frecuencia' }, height: 220 }), { responsive: true });
      Plotly.newPlot('chart-intervals-nhom', [{ x: intervalsNHom, type: 'histogram', nbinsx: 20, marker: { color: '#f43f5e' } }], Object.assign({}, darkLayout, { xaxis: { ...darkLayout.xaxis, title: 'Intervalo (años)' }, yaxis: { ...darkLayout.yaxis, title: 'Frecuencia' }, height: 220 }), { responsive: true });
    }
    
    runBtn.addEventListener('click', runMutationSimulation);
    lambdaInput.addEventListener('change', runMutationSimulation);
    slopeInput.addEventListener('change', runMutationSimulation);
    timeInput.addEventListener('change', runMutationSimulation);
    runMutationSimulation();
  });
</script>

<style>
  .hero { margin-top: 40px; padding: clamp(24px,5vw,48px); border: 1px solid var(--border); border-radius: 24px; background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01)); display: grid; grid-template-columns: 1.2fr 1fr; gap: clamp(20px,4vw,32px); box-shadow: var(--shadow); }
  .hero__copy h1 { font-size: clamp(26px,3.5vw,38px); margin-top: 8px; }
  .hero__copy .lede { margin: 12px 0 18px; max-width: 600px; color: var(--muted); }
  .hero__panel { border: 1px solid var(--border); border-radius: 18px; background: linear-gradient(160deg, var(--surface), var(--surface-2)); padding: 18px; display: grid; gap: 12px; }
  .panel__header { display: flex; justify-content: space-between; align-items: center; }
  .chip, .bubble { padding: 6px 12px; border-radius: 10px; background: rgba(34,211,238,0.1); color: var(--accent); font-weight: 700; font-size: 12px; }
  .bubble.ghost { background: rgba(255,255,255,0.04); color: var(--muted); border: 1px solid var(--border); }
  .status { color: var(--ink); font-weight: 700; }
  .panel__list { display: grid; gap: 10px; }
  .panel__item { padding: 12px 14px; border-radius: 12px; border: 1px solid var(--border); background: rgba(255,255,255,0.02); }
  .panel__item .label { color: var(--muted); font-size: 12px; display: block; margin-bottom: 4px; }
  .panel__item p.warning { color: var(--warning); }
  .panel__footer { display: flex; gap: 10px; flex-wrap: wrap; }

  .simulator { margin-top: 40px; border: 1px solid var(--border); border-radius: 24px; padding: 28px; background: linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); }
  .sim-container { display: grid; gap: 24px; }
  .sim-controls { display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end; padding: 20px; background: rgba(0,0,0,0.3); border-radius: 16px; border: 1px solid var(--border); }
  .control-group { display: flex; flex-direction: column; gap: 6px; min-width: 160px; flex: 1; }
  .control-group label { font-size: 12px; color: var(--muted); font-weight: 600; }
  .control-group input[type="range"] { width: 100%; accent-color: var(--accent); }
  .control-group span { font-size: 13px; font-weight: 700; color: var(--accent); text-align: center; background: rgba(34,211,238,0.1); padding: 4px 8px; border-radius: 6px; }
  .sim-btn { padding: 14px 28px; border-radius: 12px; border: none; background: linear-gradient(120deg, var(--accent), var(--accent-2)); color: #0c0f1a; font-weight: 700; cursor: pointer; transition: all 0.2s; font-size: 14px; display: flex; align-items: center; gap: 8px; }
  .sim-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(34,211,238,0.4); }
  .sim-btn.pulse { animation: pulse 2s infinite; }
  @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(34,211,238,0.4); } 50% { box-shadow: 0 0 0 10px rgba(34,211,238,0); } }
  .btn-icon { font-size: 18px; }
  
  .sim-stats { display: flex; gap: 16px; flex-wrap: wrap; }
  .stat-box { flex: 1; min-width: 140px; padding: 16px; border-radius: 14px; text-align: center; border: 1px solid var(--border); background: rgba(0,0,0,0.2); }
  .stat-box.hom { border-color: var(--accent); background: linear-gradient(135deg, rgba(34,211,238,0.1), rgba(34,211,238,0.02)); }
  .stat-box.nhom { border-color: var(--danger); background: linear-gradient(135deg, rgba(244,63,94,0.1), rgba(244,63,94,0.02)); }
  .stat-box.diff { border-color: var(--accent-2); background: linear-gradient(135deg, rgba(167,139,250,0.1), rgba(167,139,250,0.02)); }
  .stat-label { display: block; font-size: 11px; color: var(--muted); text-transform: uppercase; }
  .stat-value { display: block; font-size: 32px; font-weight: 700; font-family: "Space Grotesk", sans-serif; }
  .stat-box.hom .stat-value { color: var(--accent); }
  .stat-box.nhom .stat-value { color: var(--danger); }
  .stat-box.diff .stat-value { color: var(--accent-2); }
  .stat-unit { display: block; font-size: 11px; color: var(--muted); }
  
  .sim-charts-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .chart-box { padding: 16px; background: rgba(0,0,0,0.2); border: 1px solid var(--border); border-radius: 16px; }
  .chart-box.wide { grid-column: span 2; }
  .chart-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; padding-bottom: 10px; border-bottom: 1px solid var(--border); }
  .chart-header.hom { border-color: var(--accent); }
  .chart-header.nhom { border-color: var(--danger); }
  .chart-header.comparison { border-color: var(--accent-2); }
  .chart-dot { width: 10px; height: 10px; border-radius: 50%; }
  .chart-header.hom .chart-dot { background: var(--accent); box-shadow: 0 0 8px var(--accent); }
  .chart-header.nhom .chart-dot { background: var(--danger); box-shadow: 0 0 8px var(--danger); }
  .chart-header h4 { margin: 0; font-size: 14px; color: var(--ink); }
  .chart-icon { font-size: 16px; }
  .mutation-chart { width: 100%; min-height: 260px; }
  .mutation-chart.tall { min-height: 300px; }
  
  .sim-formulas { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .formula-box { padding: 20px; border: 1px solid var(--border); border-radius: 14px; background: rgba(0,0,0,0.2); }
  .formula-box.hom-box { border-color: var(--accent); background: linear-gradient(135deg, rgba(34,211,238,0.06), transparent); }
  .formula-box.nhom-box { border-color: var(--danger); background: linear-gradient(135deg, rgba(244,63,94,0.06), transparent); }
  .formula-box h5 { margin: 0 0 12px; font-size: 14px; }
  .formula-box.hom-box h5 { color: var(--accent); }
  .formula-box.nhom-box h5 { color: var(--danger); }
  .formula-content { font-size: 18px; text-align: center; padding: 12px 0; }

  .charts-section { margin-top: 40px; }
  .charts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
  .chart-card { padding: 20px; border: 1px solid var(--border); border-radius: 18px; background: rgba(255,255,255,0.02); }
  .chart-card.wide { grid-column: span 2; }
  .chart-card h4 { margin: 0 0 12px; font-size: 16px; }

  .analysis { margin-top: 40px; }
  .analysis-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
  .analysis-card { padding: 20px; border: 1px solid var(--border); border-radius: 18px; background: rgba(255,255,255,0.02); }
  .analysis-card.highlight { border-color: var(--accent); background: linear-gradient(135deg, rgba(34,211,238,0.06), rgba(167,139,250,0.04)); }
  .analysis-card.warning { border-color: var(--warning); }
  .card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
  .module-num { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; background: linear-gradient(120deg, var(--accent), var(--accent-2)); color: #0c0f1a; font-weight: 700; border-radius: 8px; font-size: 12px; }
  .card-header h4 { margin: 0; font-size: 16px; }
  .data-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .data-table td { padding: 8px 0; border-bottom: 1px solid var(--border); }
  .data-table td:first-child { color: var(--muted); }
  .data-table td.val { text-align: right; font-weight: 600; color: var(--ink); }
  .param-box { text-align: center; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 12px; margin-bottom: 16px; }
  .param-label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 4px; }
  .param-value { display: block; font-size: 28px; font-weight: 700; color: var(--accent); font-family: "Space Grotesk", sans-serif; }
  .param-ci { display: block; font-size: 12px; color: var(--muted); margin-top: 4px; }
  .param-row { display: flex; gap: 12px; }
  .param-item { flex: 1; text-align: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 10px; border: 1px solid var(--border); }
  .param-item.accent { border-color: var(--accent); background: rgba(34,211,238,0.1); }
  .param-item .label { display: block; font-size: 11px; color: var(--muted); }
  .param-item .value { display: block; font-size: 18px; font-weight: 700; color: var(--ink); margin-top: 4px; }
  .validation-grid { display: flex; gap: 12px; margin-bottom: 16px; }
  .val-metric { flex: 1; text-align: center; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 10px; }
  .val-metric.big { flex: 1.5; }
  .val-metric.warning { border: 1px solid var(--warning); background: rgba(245,158,11,0.1); }
  .metric-label { display: block; font-size: 11px; color: var(--muted); }
  .metric-value { display: block; font-size: 18px; font-weight: 700; color: var(--ink); margin-top: 4px; }
  .val-metric.warning .metric-value { color: var(--warning); }
  .conclusion { padding: 12px; border-radius: 10px; font-size: 13px; background: rgba(34,211,238,0.08); border: 1px solid var(--accent); }
  .conclusion.warning { background: rgba(245,158,11,0.1); border-color: var(--warning); }
  .model-box { text-align: center; padding: 16px; background: rgba(0,0,0,0.2); border-radius: 12px; margin-bottom: 16px; }
  .model-label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 8px; }
  .model-formula { font-size: 20px; }

  @media (max-width: 900px) {
    .hero { grid-template-columns: 1fr; }
    .sim-charts-grid, .sim-formulas, .charts-grid, .analysis-grid { grid-template-columns: 1fr; }
    .chart-box.wide, .chart-card.wide { grid-column: span 1; }
  }
</style>
